name: Deploy SAGE Documentation with Gist Integration

on:
  push:
    branches: [main]

permissions:
  contents: write

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: |
          pip install mkdocs mkdocs-material mkdocs-include-markdown-plugin mkdocstrings[python]

      - name: Inject GitHub Token for Gist Access
        run: |
          # åˆ›å»ºè¿è¡Œæ—¶é…ç½®æ–‡ä»¶ï¼Œæ³¨å…¥ GitHub Token
          mkdir -p docs_src/assets/js
          cat > docs_src/assets/js/runtime-config.js << 'EOF'
          // Runtime configuration injected during build
          window.SAGE_RUNTIME_CONFIG = window.SAGE_RUNTIME_CONFIG || {};
          window.SAGE_RUNTIME_CONFIG.gistToken = '${{ secrets.GIST_TOKEN }}';
          console.log('ðŸ”‘ GitHub Token å·²ä»ŽçŽ¯å¢ƒå˜é‡æ³¨å…¥');
          EOF
          
          # åœ¨ weekly_meeting_v2.md ä¸­æ³¨å…¥é…ç½®å¼•ç”¨
          sed -i '/<script>/i <script src="../../assets/js/runtime-config.js"></script>' docs_src/join_sage/weekly_meeting_v2.md

      - name: Build and deploy
        run: mkdocs gh-deploy --force
