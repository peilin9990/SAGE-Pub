name: Deploy SAGE Documentation with Gist Integration

on:
  push:
    branches: [main]

permissions:
  contents: write

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: |
          pip install mkdocs mkdocs-material mkdocs-include-markdown-plugin mkdocstrings[python]

      - name: Setup Runtime Configuration (Secure)
        run: |
          # åˆ›å»ºå®‰å…¨çš„è¿è¡Œæ—¶é…ç½®ï¼Œä¸ç›´æŽ¥æš´éœ² Token
          mkdir -p docs_src/assets/js
          cat > docs_src/assets/js/runtime-config.js << 'EOF'
          // Runtime configuration - å®‰å…¨ç‰ˆæœ¬
          window.SAGE_RUNTIME_CONFIG = window.SAGE_RUNTIME_CONFIG || {};
          
          // ä¸ç›´æŽ¥å­˜å‚¨ Tokenï¼Œè€Œæ˜¯æä¾›é…ç½®æ–¹æ³•
          window.SAGE_RUNTIME_CONFIG.setGistToken = function(token) {
            this.gistToken = token;
            console.log('ðŸ”‘ Gist Token å·²è®¾ç½®');
          };
          
          // ç”Ÿäº§çŽ¯å¢ƒæ ‡è¯†
          window.SAGE_RUNTIME_CONFIG.environment = 'production';
          window.SAGE_RUNTIME_CONFIG.buildTime = new Date().toISOString();
          
          console.log('ðŸš€ ç”Ÿäº§çŽ¯å¢ƒé…ç½®å·²åŠ è½½');
          EOF

      - name: Build and deploy
        run: mkdocs gh-deploy --force
